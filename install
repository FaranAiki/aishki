#!/bin/sh

# (C) Copyright 2023 Muhammad Faran Aiki
# Installation of my shell scripts

set -eu

cd $(dirname "$0")

VERSION=0.1

if [ "$EUID" -ne 0 ] || ! [ -n "${SUDO_USER+x}" ]; then
	echo "Please run as root"
	exit 127
fi

USER="/home/${SUDO_USER}"
PREFIX="/usr/local"
MANPREFIX="${PREFIX}/share/man"

pli_tools() {
	if [ "$#" -eq 0 ]; then
		exit 1;
	fi

	echo "Installing $1"
	cp -f "tools/$1" "${PREFIX}/bin"
	cp -f "tools/$1.1" "${MANPREFIX}/man1"
	chmod +x "${PREFIX}/bin/$1"
	echo "Success"
}

tools() {
	mkdir -p "${PREFIX}/bin"
	mkdir -p "${MANPREFIX}/man1"

	pli_tools mkdesk	
	pli_tools miplay	

	echo "Finished installing tools"
}

config() {
	echo "Are you really sure you want to install config? (it will override your current config) [y/N]"
	read -p "> " ans

	if [ "$ans" != "y" ];
	then
		return
	fi

	echo "Configuring .bashrc"
	cp -f "config/.bashrc" "${USER}"

	echo "Configuring .zshrc"
	cp -f "config/.zshrc" "${USER}"
	
	echo "Finished installing config"
}

all() {
	config
	tools
	echo "Finished installing all"
}

if [ "$#" -eq 0 ]; then
	all
	exit 0
fi

if [ "$1" == "--help" ]; then
	echo "Install options:"
	echo "  --help"
	echo "  all"
	echo "  tools"
	echo "  config"
	echo "  pli_tools"
	echo
	echo "Beware that install [COMMAND] will result in the execution of [COMMAND]"
	exit 1
fi

$1

cd - 
